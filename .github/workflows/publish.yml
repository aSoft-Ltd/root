# This file was generated using Kotlin DSL (.github/workflows/publish.main.kts).
# If you want to modify the workflow, please change the Kotlin file and regenerate this YAML file.
# Generated with https://github.com/krzema12/github-actions-kotlin-dsl

name: Build, Cache then Publish

on:
  push:
    branches:
      - 'main'

env:
  ASOFT_MAVEN_PGP_PRIVATE_KEY: ${{ secrets.ASOFT_MAVEN_PGP_PRIVATE_KEY }}
  ASOFT_MAVEN_PGP_PASSWORD: ${{ secrets.ASOFT_MAVEN_PGP_PASSWORD }}
  ASOFT_NEXUS_PASSWORD: ${{ secrets.ASOFT_NEXUS_PASSWORD }}
  ASOFT_NEXUS_USERNAME: ${{ secrets.ASOFT_NEXUS_USERNAME }}

jobs:
  "functions-builder":
    runs-on: "macos-latest"
    steps:
      - id: step-0
        uses: actions/checkout@v3
        with:
          submodules: true
      - id: step-1
        uses: actions/setup-java@v3
        with:
          java-version: 18
          distribution: corretto
      - id: step-2
        name: Make ./gradlew executable
        working-directory: functions
        run: chmod +x ./gradlew
      - id: step-3
        name: building functions-core [INCLUDE_BUILD=false]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :functions-core:build
          build-root-directory: ./functions
        env:
          INCLUDE_BUILD: false
      - id: step-4
        name: building functions-core [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :functions-core:build
          build-root-directory: ./functions
        env:
          INCLUDE_BUILD: true
  "expect-builder":
    runs-on: "macos-latest"
    steps:
      - id: step-0
        uses: actions/checkout@v3
        with:
          submodules: true
      - id: step-1
        uses: actions/setup-java@v3
        with:
          java-version: 18
          distribution: corretto
      - id: step-2
        name: Make ./gradlew executable
        working-directory: expect
        run: chmod +x ./gradlew
      - id: step-3
        name: building expect-core [INCLUDE_BUILD=false]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :expect-core:build
          build-root-directory: ./expect
        env:
          INCLUDE_BUILD: false
      - id: step-4
        name: building expect-core [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :expect-core:build
          build-root-directory: ./expect
        env:
          INCLUDE_BUILD: true
      - id: step-5
        name: building expect-coroutines [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :expect-coroutines:build
          build-root-directory: ./expect
        env:
          INCLUDE_BUILD: true
  "koncurrent-primitives-builder":
    runs-on: "macos-latest"
    steps:
      - id: step-0
        uses: actions/checkout@v3
        with:
          submodules: true
      - id: step-1
        uses: actions/setup-java@v3
        with:
          java-version: 18
          distribution: corretto
      - id: step-2
        name: Make ./gradlew executable
        working-directory: koncurrent
        run: chmod +x ./gradlew
      - id: step-3
        name: building koncurrent-primitives-core [INCLUDE_BUILD=false]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :koncurrent-primitives-core:build
          build-root-directory: ./koncurrent
        env:
          INCLUDE_BUILD: false
      - id: step-4
        name: building koncurrent-primitives-core [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :koncurrent-primitives-core:build
          build-root-directory: ./koncurrent
        env:
          INCLUDE_BUILD: true
      - id: step-5
        name: building koncurrent-primitives-coroutines [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :koncurrent-primitives-coroutines:build
          build-root-directory: ./koncurrent
        env:
          INCLUDE_BUILD: true
      - id: step-6
        name: building koncurrent-primitives-mock [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :koncurrent-primitives-mock:build
          build-root-directory: ./koncurrent
        env:
          INCLUDE_BUILD: true
  "koncurrent-later-builder":
    runs-on: "macos-latest"
    steps:
      - id: step-0
        uses: actions/checkout@v3
        with:
          submodules: true
      - id: step-1
        uses: actions/setup-java@v3
        with:
          java-version: 18
          distribution: corretto
      - id: step-2
        name: Make ./gradlew executable
        working-directory: koncurrent
        run: chmod +x ./gradlew
      - id: step-3
        name: building koncurrent-later-core [INCLUDE_BUILD=false]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :koncurrent-later-core:build
          build-root-directory: ./koncurrent
        env:
          INCLUDE_BUILD: false
      - id: step-4
        name: building koncurrent-later-core [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :koncurrent-later-core:build
          build-root-directory: ./koncurrent
        env:
          INCLUDE_BUILD: true
      - id: step-5
        name: building koncurrent-later-coroutines [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :koncurrent-later-coroutines:build
          build-root-directory: ./koncurrent
        env:
          INCLUDE_BUILD: true
      - id: step-6
        name: building koncurrent-later-test [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :koncurrent-later-test:build
          build-root-directory: ./koncurrent
        env:
          INCLUDE_BUILD: true
  "live-builder":
    runs-on: "macos-latest"
    steps:
      - id: step-0
        uses: actions/checkout@v3
        with:
          submodules: true
      - id: step-1
        uses: actions/setup-java@v3
        with:
          java-version: 18
          distribution: corretto
      - id: step-2
        name: Make ./gradlew executable
        working-directory: live
        run: chmod +x ./gradlew
      - id: step-3
        name: building live-core [INCLUDE_BUILD=false]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :live-core:build
          build-root-directory: ./live
        env:
          INCLUDE_BUILD: false
      - id: step-4
        name: building live-core [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :live-core:build
          build-root-directory: ./live
        env:
          INCLUDE_BUILD: true
      - id: step-5
        name: building live-coroutines [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :live-coroutines:build
          build-root-directory: ./live
        env:
          INCLUDE_BUILD: true
      - id: step-6
        name: building live-react [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :live-react:build
          build-root-directory: ./live
        env:
          INCLUDE_BUILD: true
      - id: step-7
        name: building live-test [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :live-test:build
          build-root-directory: ./live
        env:
          INCLUDE_BUILD: true
  "viewmodel-builder":
    runs-on: "macos-latest"
    steps:
      - id: step-0
        uses: actions/checkout@v3
        with:
          submodules: true
      - id: step-1
        uses: actions/setup-java@v3
        with:
          java-version: 18
          distribution: corretto
      - id: step-2
        name: Make ./gradlew executable
        working-directory: viewmodel
        run: chmod +x ./gradlew
      - id: step-3
        name: building viewmodel-core [INCLUDE_BUILD=false]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :viewmodel-core:build
          build-root-directory: ./viewmodel
        env:
          INCLUDE_BUILD: false
      - id: step-4
        name: building viewmodel-core [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :viewmodel-core:build
          build-root-directory: ./viewmodel
        env:
          INCLUDE_BUILD: true
  "cache-builder":
    runs-on: "macos-latest"
    steps:
      - id: step-0
        uses: actions/checkout@v3
        with:
          submodules: true
      - id: step-1
        uses: actions/setup-java@v3
        with:
          java-version: 18
          distribution: corretto
      - id: step-2
        name: Make ./gradlew executable
        working-directory: cache
        run: chmod +x ./gradlew
      - id: step-3
        name: building cache-api [INCLUDE_BUILD=false]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :cache-api:build
          build-root-directory: ./cache
        env:
          INCLUDE_BUILD: false
      - id: step-4
        name: building cache-api [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :cache-api:build
          build-root-directory: ./cache
        env:
          INCLUDE_BUILD: true
      - id: step-5
        name: building cache-browser [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :cache-browser:build
          build-root-directory: ./cache
        env:
          INCLUDE_BUILD: true
      - id: step-6
        name: building cache-file [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :cache-file:build
          build-root-directory: ./cache
        env:
          INCLUDE_BUILD: true
      - id: step-7
        name: building cache-mock [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :cache-mock:build
          build-root-directory: ./cache
        env:
          INCLUDE_BUILD: true
      - id: step-8
        name: building cache-react-native [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :cache-react-native:build
          build-root-directory: ./cache
        env:
          INCLUDE_BUILD: true
  "rendezvous":
    runs-on: "ubuntu-latest"
    needs:
      - "functions-builder"
      - "expect-builder"
      - "koncurrent-primitives-builder"
      - "koncurrent-later-builder"
      - "live-builder"
      - "viewmodel-builder"
      - "cache-builder"
    steps:
      - id: step-0
        run: echo "all builds completed. Beginning deployment"
  "functions-publisher":
    runs-on: "macos-latest"
    needs:
      - "rendezvous"
    steps:
      - id: step-0
        uses: actions/checkout@v3
        with:
          submodules: true
      - id: step-1
        uses: actions/setup-java@v3
        with:
          java-version: 18
          distribution: corretto
      - id: step-2
        name: Make ./gradlew executable
        working-directory: functions
        run: chmod +x ./gradlew
      - id: step-3
        name: building functions-core [INCLUDE_BUILD=false]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :functions-core:build
          build-root-directory: ./functions
        env:
          INCLUDE_BUILD: false
      - id: step-4
        name: publishing functions-core [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :functions-core:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./functions
        env:
          INCLUDE_BUILD: true
  "expect-publisher":
    runs-on: "macos-latest"
    needs:
      - "rendezvous"
    steps:
      - id: step-0
        uses: actions/checkout@v3
        with:
          submodules: true
      - id: step-1
        uses: actions/setup-java@v3
        with:
          java-version: 18
          distribution: corretto
      - id: step-2
        name: Make ./gradlew executable
        working-directory: expect
        run: chmod +x ./gradlew
      - id: step-3
        name: building expect-core [INCLUDE_BUILD=false]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :expect-core:build
          build-root-directory: ./expect
        env:
          INCLUDE_BUILD: false
      - id: step-4
        name: publishing expect-core [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :expect-core:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./expect
        env:
          INCLUDE_BUILD: true
      - id: step-5
        name: publishing expect-coroutines [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :expect-coroutines:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./expect
        env:
          INCLUDE_BUILD: true
  "koncurrent-primitives-publisher":
    runs-on: "macos-latest"
    needs:
      - "rendezvous"
    steps:
      - id: step-0
        uses: actions/checkout@v3
        with:
          submodules: true
      - id: step-1
        uses: actions/setup-java@v3
        with:
          java-version: 18
          distribution: corretto
      - id: step-2
        name: Make ./gradlew executable
        working-directory: koncurrent
        run: chmod +x ./gradlew
      - id: step-3
        name: building koncurrent-primitives-core [INCLUDE_BUILD=false]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :koncurrent-primitives-core:build
          build-root-directory: ./koncurrent
        env:
          INCLUDE_BUILD: false
      - id: step-4
        name: publishing koncurrent-primitives-core [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :koncurrent-primitives-core:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./koncurrent
        env:
          INCLUDE_BUILD: true
      - id: step-5
        name: publishing koncurrent-primitives-coroutines [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :koncurrent-primitives-coroutines:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./koncurrent
        env:
          INCLUDE_BUILD: true
      - id: step-6
        name: publishing koncurrent-primitives-mock [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :koncurrent-primitives-mock:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./koncurrent
        env:
          INCLUDE_BUILD: true
  "koncurrent-later-publisher":
    runs-on: "macos-latest"
    needs:
      - "rendezvous"
    steps:
      - id: step-0
        uses: actions/checkout@v3
        with:
          submodules: true
      - id: step-1
        uses: actions/setup-java@v3
        with:
          java-version: 18
          distribution: corretto
      - id: step-2
        name: Make ./gradlew executable
        working-directory: koncurrent
        run: chmod +x ./gradlew
      - id: step-3
        name: building koncurrent-later-core [INCLUDE_BUILD=false]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :koncurrent-later-core:build
          build-root-directory: ./koncurrent
        env:
          INCLUDE_BUILD: false
      - id: step-4
        name: publishing koncurrent-later-core [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :koncurrent-later-core:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./koncurrent
        env:
          INCLUDE_BUILD: true
      - id: step-5
        name: publishing koncurrent-later-coroutines [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :koncurrent-later-coroutines:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./koncurrent
        env:
          INCLUDE_BUILD: true
      - id: step-6
        name: publishing koncurrent-later-test [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :koncurrent-later-test:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./koncurrent
        env:
          INCLUDE_BUILD: true
  "live-publisher":
    runs-on: "macos-latest"
    needs:
      - "rendezvous"
    steps:
      - id: step-0
        uses: actions/checkout@v3
        with:
          submodules: true
      - id: step-1
        uses: actions/setup-java@v3
        with:
          java-version: 18
          distribution: corretto
      - id: step-2
        name: Make ./gradlew executable
        working-directory: live
        run: chmod +x ./gradlew
      - id: step-3
        name: building live-core [INCLUDE_BUILD=false]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :live-core:build
          build-root-directory: ./live
        env:
          INCLUDE_BUILD: false
      - id: step-4
        name: publishing live-core [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :live-core:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./live
        env:
          INCLUDE_BUILD: true
      - id: step-5
        name: publishing live-coroutines [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :live-coroutines:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./live
        env:
          INCLUDE_BUILD: true
      - id: step-6
        name: publishing live-react [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :live-react:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./live
        env:
          INCLUDE_BUILD: true
      - id: step-7
        name: publishing live-test [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :live-test:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./live
        env:
          INCLUDE_BUILD: true
  "viewmodel-publisher":
    runs-on: "macos-latest"
    needs:
      - "rendezvous"
    steps:
      - id: step-0
        uses: actions/checkout@v3
        with:
          submodules: true
      - id: step-1
        uses: actions/setup-java@v3
        with:
          java-version: 18
          distribution: corretto
      - id: step-2
        name: Make ./gradlew executable
        working-directory: viewmodel
        run: chmod +x ./gradlew
      - id: step-3
        name: building viewmodel-core [INCLUDE_BUILD=false]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :viewmodel-core:build
          build-root-directory: ./viewmodel
        env:
          INCLUDE_BUILD: false
      - id: step-4
        name: publishing viewmodel-core [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :viewmodel-core:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./viewmodel
        env:
          INCLUDE_BUILD: true
  "cache-publisher":
    runs-on: "macos-latest"
    needs:
      - "rendezvous"
    steps:
      - id: step-0
        uses: actions/checkout@v3
        with:
          submodules: true
      - id: step-1
        uses: actions/setup-java@v3
        with:
          java-version: 18
          distribution: corretto
      - id: step-2
        name: Make ./gradlew executable
        working-directory: cache
        run: chmod +x ./gradlew
      - id: step-3
        name: building cache-api [INCLUDE_BUILD=false]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :cache-api:build
          build-root-directory: ./cache
        env:
          INCLUDE_BUILD: false
      - id: step-4
        name: publishing cache-api [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :cache-api:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./cache
        env:
          INCLUDE_BUILD: true
      - id: step-5
        name: publishing cache-browser [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :cache-browser:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./cache
        env:
          INCLUDE_BUILD: true
      - id: step-6
        name: publishing cache-file [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :cache-file:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./cache
        env:
          INCLUDE_BUILD: true
      - id: step-7
        name: publishing cache-mock [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :cache-mock:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./cache
        env:
          INCLUDE_BUILD: true
      - id: step-8
        name: publishing cache-react-native [INCLUDE_BUILD=true]
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :cache-react-native:publishToSonatype closeAndReleaseStagingRepository
          build-root-directory: ./cache
        env:
          INCLUDE_BUILD: true

