# This file was generated using Kotlin DSL (.github/workflows/publish.main.kts).
# If you want to modify the workflow, please change the Kotlin file and regenerate this YAML file.
# Generated with https://github.com/krzema12/github-actions-kotlin-dsl

name: Build, Cache then Publish

on:
  push:
    branches:
      - 'main'

env:
  ASOFT_MAVEN_PGP_PRIVATE_KEY: ${{ secrets.ASOFT_MAVEN_PGP_PRIVATE_KEY }}
  ASOFT_MAVEN_PGP_PASSWORD: ${{ secrets.ASOFT_MAVEN_PGP_PASSWORD }}
  ASOFT_NEXUS_PASSWORD: ${{ secrets.ASOFT_NEXUS_PASSWORD }}
  ASOFT_NEXUS_USERNAME: ${{ secrets.ASOFT_NEXUS_USERNAME }}
  INCLUDE_BUILD: true

jobs:
  "rendezvous":
    runs-on: "ubuntu-latest"
    steps:
      - id: step-0
        run: echo "all builds completed. Beginning deployment"
  "publish-live":
    runs-on: "macos-latest"
    needs:
      - "rendezvous"
    steps:
      - id: step-0
        uses: actions/checkout@v3
        with:
          submodules: true
      - id: step-1
        uses: actions/setup-java@v3
        with:
          java-version: 18
          distribution: corretto
      - id: step-2
        name: Cache gradle
        uses: gradle/gradle-build-action@v2
        with:
          build-root-directory: ./live
      - id: step-3
        name: Make ./gradlew executable
        working-directory: live
        run: chmod +x ./gradlew
      - id: step-4
        name: publish live-core
        working-directory: ./live
        run: :live-core:publishToSonatype
      - id: step-5
        name: publish live-coroutines
        working-directory: ./live
        run: :live-coroutines:publishToSonatype
      - id: step-6
        name: publish live-react
        working-directory: ./live
        run: :live-react:publishToSonatype
      - id: step-7
        name: publish live-test
        working-directory: ./live
        run: :live-test:publishToSonatype
  "publish-viewmodel":
    runs-on: "macos-latest"
    needs:
      - "rendezvous"
    steps:
      - id: step-0
        uses: actions/checkout@v3
        with:
          submodules: true
      - id: step-1
        uses: actions/setup-java@v3
        with:
          java-version: 18
          distribution: corretto
      - id: step-2
        name: Cache gradle
        uses: gradle/gradle-build-action@v2
        with:
          build-root-directory: ./viewmodel
      - id: step-3
        name: Make ./gradlew executable
        working-directory: viewmodel
        run: chmod +x ./gradlew
      - id: step-4
        name: publish viewmodel-core
        working-directory: ./viewmodel
        run: :viewmodel-core:publishToSonatype
      - id: step-5
        name: publish viewmodel-coroutines
        working-directory: ./viewmodel
        run: :viewmodel-coroutines:publishToSonatype
      - id: step-6
        name: publish viewmodel-react
        working-directory: ./viewmodel
        run: :viewmodel-react:publishToSonatype
      - id: step-7
        name: publish viewmodel-test
        working-directory: ./viewmodel
        run: :viewmodel-test:publishToSonatype

